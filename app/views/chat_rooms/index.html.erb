<!-- app/views/chat_rooms/chatindex.html.erb -->

<div class="flex h-[calc(100vh-4rem)]">
  <!-- ğŸ’¬ Chat List Sidebar -->
  <aside class="w-80 bg-[#1e1f29] border-r border-[#44475a] overflow-y-auto p-4">
    <h2 class="text-lg font-semibold text-[#f8f8f2] mb-4">Your Chats</h2>

    <% @chat_rooms.each do |room| %>
      <% recipient = room.other_participant(current_user) %>
      <% last_message = room.messages.last %>

      <%= link_to chat_room_path(room),
                  data: { turbo_frame: "dashboard" },
                  class: "block mb-2 p-3 rounded-lg bg-[#282a36] text-[#f8f8f2] hover:bg-[#44475a] transition" do %>

        <div class="flex items-center gap-3">
          <% if recipient.avatar.attached? %>
            <%= image_tag recipient.avatar.variant(resize_to_fill: [40, 40]),
                          class: "rounded-full h-10 w-10 object-cover" %>
          <% else %>
            <%= image_tag avatar_url_for(recipient),
                          class: "rounded-full h-10 w-10 object-cover" %>
          <% end %>

          <div class="flex-1">
            <div class="font-medium">
              <%= recipient.username || recipient.email.split('@').first %>
            </div>
            <div class="text-xs text-[#6272a4] flex justify-between items-center gap-1">
              <span class="truncate max-w-[70%] italic">
                <%= last_message&.body&.truncate(30) || "No messages yet" %>
              </span>
              <% if last_message %>
                <span class="whitespace-nowrap text-[10px]">
                  <%= last_message.created_at.strftime("%-I:%M %p") %>
                </span>
              <% end %>
            </div>
          </div>
        </div>

      <% end %>
    <% end %>
  </aside>
</div>
