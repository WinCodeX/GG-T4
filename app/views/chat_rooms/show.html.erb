
<%= turbo_stream_from current_user %>
  <div class="flex h-[calc(100vh-4rem)] overflow-hidden">

    <!-- Sidebar -->
    <%= render "chat_rooms/chatindex", chat_rooms: @chat_rooms %>

    <!-- Chat Room Panel -->
    <div class="flex-1 h-full flex flex-col bg-[#0d0d0d] text-white">

      <!-- Chat Header -->
      <div class="sticky top-0 z-40 bg-[#1e1f29] px-4 py-2 flex items-center justify-between border-b border-[#44475a]">
        <div class="flex items-center space-x-3">
          <%= render "shared/user_avatar_with_name", user: @chat_with %>
        </div>
        <div class="flex space-x-4 text-gray-300">
          <!-- Search / Dots icons -->
        </div>
      </div>

      <!-- Messages Panel -->
      <div id="messages" class="flex-1 max-w-full overflow-x-hidden overflow-y-auto px-4 py-3 space-y-3 bg-[#0d0d0d]">
        <%= turbo_stream_from @chat_room %>
        <% @messages.each do |message| %>
          <% mine = message.user_id == current_user.id %>
          <div class="flex <%= mine ? 'justify-end' : 'justify-start' %>">
            <div class="<%= mine ? 'bg-[#005c4b]' : 'bg-[#1e1f29]' %> max-w-[75%] px-4 py-2 rounded-2xl shadow-sm">
              <div class="whitespace-pre-line text-sm"><%= message.body %></div>
              <div class="text-[11px] text-gray-400 mt-1 text-right">
                <%= message.created_at.strftime("%H:%M") %>
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Message Input -->
      <div class="w-full sticky bottom-0 p-4 bg-[#1e1f29] flex items-center">
        <%= form_with(model: [@chat_room, Message.new], data: { turbo_stream: true }, class: "flex w-full items-center gap-2") do |f| %>
          <div class="relative flex-1">
            <%= f.text_area :body,
              placeholder: "Type a message...",
              rows: 1,
             class: "resize-none w-full max-w-full py-2 pl-4 pr-12 rounded-full bg-[#282a36] text-white placeholder:text-gray-400 border border-[#44475a] focus:outline-none focus:ring-2 focus:ring-[#bd93f9] text-sm" %>

            <div class="absolute right-4 top-0.5 flex items-center">
              <%= button_tag type: "submit", class: "text-[#bd93f9] hover:text-white transition" do %>
                <!-- Send icon -->
              <% end %>
            </div>
          </div>
        <% end %>
      </div>

    </div>
  </div>
