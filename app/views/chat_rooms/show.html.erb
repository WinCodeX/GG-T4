<div class="h-full w-full flex flex-col bg-[#0d0d0d] text-white">
<!-- 💬 Chat Header -->
<div class="sticky top-0 z-40 bg-[#1e1f29] px-4 py-2 flex items-center justify-between border-b border-[#44475a]">
  <!-- 👤 Left: Avatar + Info -->
  <div class="flex items-center space-x-3">
  <%= render "shared/user_avatar_with_name", user: @chat_with %>
  </div>

  <!-- 🔍 & ⋮ Icons -->
  <div class="flex space-x-4 text-gray-300">
    <!-- Search Icon -->
    <svg xmlns="http://www.w3.org/2000/svg"
         viewBox="0 0 24 24"
         fill="currentColor"
         class="w-5 h-5 cursor-pointer hover:text-white">
      <path fill-rule="evenodd"
            d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z"
            clip-rule="evenodd" />
    </svg>

    <!-- Vertical Dots Icon -->
    <svg xmlns="http://www.w3.org/2000/svg"
         viewBox="0 0 24 24"
         fill="currentColor"
         class="w-5 h-5 cursor-pointer hover:text-white">
      <path fill-rule="evenodd"
            d="M10.5 6a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Zm0 6a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Zm0 6a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"
            clip-rule="evenodd" />
    </svg>
  </div>
</div>


  <!-- 💬 Messages Panel -->
  <div id="messages"
       class="flex-1 w-full overflow-y-auto px-4 py-3 space-y-3 bg-[#0d0d0d]">
    <%= turbo_stream_from @chat_room %>
    <% @messages.each do |message| %>
      <% mine = message.user_id == current_user.id %>
      <div class="flex <%= mine ? 'justify-end' : 'justify-start' %>">
        <div class="<%= mine ? 'bg-[#005c4b]' : 'bg-[#1e1f29]' %> max-w-[75%] px-4 py-2 rounded-2xl shadow-sm">
          <div class="whitespace-pre-line text-sm"><%= message.body %></div>
          <div class="text-[11px] text-gray-400 mt-1 text-right">
            <%= message.created_at.strftime("%H:%M") %>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <!-- ✍️ Message Input -->
<div class="w-full sticky bottom-0 p-4 bg-[#1e1f29] flex items-center">
  <%= form_with(model: [@chat_room, Message.new],
                data: { turbo_stream: true },
                class: "flex w-full items-center gap-2") do |f| %>

    <!-- 💬 Text Area -->
    <div class="relative flex-1">
      <%= f.text_area :body,
            placeholder: "Type a message...",
            rows: 1,
            class: "w-full resize-none p-2 pr-12 rounded-full bg-[#282a36] text-white border border-[#44475a] focus:outline-none focus:ring-2 focus:ring-[#bd93f9] text-sm py-2 px-4" %>

      <!-- 📨 Send Button (inside input on the right) -->
      <div class="absolute right-4 top-0.5 flex items-center" style: "resize:none" >
        <%= button_tag type: "submit", class: "text-[#bd93f9] hover:text-white transition" do %>
          <svg xmlns="http://www.w3.org/2000/svg"
               viewBox="0 0 24 24"
               fill="currentColor"
               class="w-5 h-5">
            <path d="M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z" />
          </svg>
        <% end %>
      </div>
    </div>

  <% end %>
</div>

  </div>
</div>
